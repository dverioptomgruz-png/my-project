# Глубокий анализ блоков для Avito Neuro Assistant

## Что удалось проверить в сети
В рамках среды выполнены попытки прямого доступа к developer-порталу Avito:
- `curl -L --max-time 20 https://developers.avito.ru/`
- `curl -L --max-time 20 https://r.jina.ai/http://developers.avito.ru/`

Обе попытки завершились `CONNECT tunnel failed, response 403`, поэтому прямой парсинг документации из окружения недоступен. Ниже — архитектура на основе типовых паттернов Avito API-интеграций, требований marketplace-коммуникаций и практик CRM-связок.

## 1) CRM-коннектор: что критично закрыть

### 1.1. Гибкость под любую CRM
Нужен не «коннектор под одну CRM», а адаптер:
- выбор провайдера (Bitrix24, amoCRM, HubSpot, кастом);
- кастомный field mapping (Avito-поля -> CRM-поля);
- маппинг этапов воронки (`newLead/inProgress/won/lost`);
- объектная модель (`lead/contact/deal/task`) с флагами включения.

### 1.2. Надёжность интеграции
- контроль срока жизни токена и наличие refresh token;
- webhook subscriptions на ключевые события (`lead.created`, `message.received`, `deal.updated`);
- fallback на polling/гибридную синхронизацию;
- rate-limit policy с backoff, чтобы переживать пики/ограничения API.

### 1.3. Операционная прозрачность
В продукте обязателен снапшот состояния интеграции:
- подключено/не подключено;
- жив ли webhook;
- TTL токена в минутах;
- когда была последняя синхронизация;
- сводка по последней отправке.

## 2) Всегда в сети: почему toggle достаточно
По вашему требованию реализован лёгкий переключатель, но с бизнес-логикой:
- `enabled` состояние;
- шаблон автоответа;
- heartbeat интервал;
- таймштамп последнего heartbeat.

Это даёт контроль SLA первого ответа и готовую точку расширения под очередь сообщений.

## 3) A/B тестирование как AI-чат (новый формат)

### 3.1. Целевой UX
Пользователь нажимает кнопку -> открывается чат с адаптированным ассистентом:
1. вводит нишу и контекст;
2. AI задаёт уточняющие вопросы, если бриф недостаточно полный;
3. AI выдаёт 3–5 вариантов заголовков и текстов;
4. AI добавляет рекомендации по главным изображениям;
5. AI формирует чеклист запуска теста.

### 3.2. Что генерируется автоматически
- Варианты заголовков под тон (friendly/expert/premium).
- Варианты текстов с офферами и следующими шагами (чат/звонок/заявка).
- Рекомендации по обложкам:
  - крупный план объекта;
  - lifestyle кадр с применением;
  - инфографика с 2–3 преимуществами;
  - сплит по цветовой температуре/ракурсу.

### 3.3. Рекомендуемые метрики запуска
- CTR карточки/объявления;
- доля входящих сообщений;
- стоимость обращения;
- конверсия в целевое действие;
- скорость первого ответа.

## Итог внедрения
В проект внедрены:
1. CRM-модуль с расширенной конфигурацией и синком.
2. Toggle «Всегда в сети» с heartbeat и шаблоном автоответа.
3. AI-чат A/B тестирования с уточняющими вопросами и генерацией 4 вариантов + image-рекомендаций.

Это закрывает текущий функциональный запрос и оставляет прямой путь к production-интеграции (backend + реальные API ключи + БД + event bus).
